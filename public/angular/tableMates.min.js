(function(){angular.module("tableMates",["ngRoute","ngSanitize"]);function t(t,e){t.when("/",{templateUrl:"/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"/common/views/genericText.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/appointment",{templateUrl:"/appointments/appointments.view.html",controller:"appointmentsCtrl",controllerAs:"vm"}).when("/appointment/:appointmentid",{templateUrl:"/appointmentDetail/appointmentDetail.view.html",controller:"appointmentDetailCtrl",controllerAs:"vm"}).when("/create",{templateUrl:"/appointmentCreate/appointmentCreate.view.html",controller:"appointmentCreateCtrl",controllerAs:"vm"}).when("/myAppointments",{templateUrl:"/appointments/myAppointments.view.html",controller:"myAppointmentsCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"})}angular.module("tableMates").config(["$routeProvider","$httpProvider",t])})();(function(){angular.module("tableMates").controller("homeCtrl",t);t.$inject=["$scope"];function t(t){var e=this;e.title="tableMates"}})();(function(){angular.module("tableMates").directive("navigation",t);function t(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("tableMates").controller("navigationCtrl",t);t.$inject=["$location","authentication"];function t(t,e){var n=this;n.currentPath=t.path();n.isLoggedIn=e.isLoggedIn();n.currentUser=e.currentUser();n.logout=function(){e.logout();t.path("/#/")}}})();(function(){angular.module("tableMates").controller("appointmentsCtrl",t);t.$inject=["$routeParams","api","authentication","$location"];function t(t,e,n,r){var o=this;o.currentUser=n.currentUser();e.allAppointments().success(function(t){var e=[];for(var n=0;n<t.length;n++){t[n].canAttend=true;for(var r in t[n].Attendees){if(t[n].Attendees[r].username==o.currentUser.name){t[n].canAttend=false}}e.push(t[n])}o.data={appointments:e}}).error(function(t){console.log(t)});o.attend=function(t){console.log(t);e.attendAppointment(o.currentUser.name,t);r.path("/myAppointments")}}})();(function(){angular.module("tableMates").controller("appointmentDetailCtrl",t);t.$inject=["$routeParams","api"];function t(t,e){var n=this;n.appointmentid=t.appointmentid;e.appointmentById(n.appointmentid).success(function(t){n.data={appointment:t}}).error(function(t){console.log(t)})}})();(function(){angular.module("tableMates").controller("appointmentCreateCtrl",t);t.$inject=["api","$location","authentication"];function t(t,e,n){var r=this;r.currentUser=n.currentUser();r.submit=function(){r.formError="";if(!r.formData.AppointmentName||!r.formData.MinAttendees||!r.formData.RestaurantName||!r.formData.AppointmentDate||!r.formData.Lat||!r.formData.Lng){r.formError="All fields required, please try again";return false}else{r.makeAppointment(r.formData)}};r.makeAppointment=function(n){console.log("Username field is being set to: "+n.Attendee);t.createAppointment({Lat:n.Lat,Lng:n.Lng,MinAttendees:n.MinAttendees,MaxAttendees:n.MaxAttendees,AppointmentName:n.AppointmentName,RestaurantName:n.RestaurantName,AppointmentDate:n.AppointmentDate}).success(function(t){console.log("it worked! you posted this data: \n"+t);e.path("/#/appointment")}).error(function(t){console.log("Something went wrong");r.formError="Your data didn't post, please try again."});return false}}})();(function(){angular.module("tableMates").controller("myAppointmentsCtrl",t);t.$inject=["$routeParams","api","authentication"];function t(t,e,n){var r=this;r.currentUser=n.currentUser();e.allAppointments().success(function(t){var e=[];for(var n=0;n<t.length;n++){for(var o in t[n].Attendees){console.log(t[n].Attendees[o]);if(t[n].Attendees[o].username==r.currentUser.name){e.push(t[n])}}}r.data={appointments:e}}).error(function(t){console.log(t)})}})();(function(){angular.module("tableMates").controller("loginCtrl",t);t.$inject=["$location","authentication"];function t(t,e){var n=this;n.pageHeader={title:"Sign in to TableMates"};n.credentials={email:"",password:""};n.returnPage=t.search().page||"/";n.onSubmit=function(){n.formError="";if(!n.credentials.email||!n.credentials.password){n.formError="All fields required, please try again";return false}else{n.doLogin()}};n.doLogin=function(){n.formError="";e.login(n.credentials).error(function(t){n.formError=t}).then(function(){t.search("page",null);t.path(n.returnPage)})}}})();(function(){angular.module("tableMates").controller("registerCtrl",t);t.$inject=["$location","authentication"];function t(t,e){var n=this;n.pageHeader={title:"Create a new TableMates account"};n.credentials={name:"",email:"",password:""};n.returnPage=t.search().page||"/";n.onSubmit=function(){n.formError="";if(!n.credentials.name||!n.credentials.email||!n.credentials.password){n.formError="All fields required, please try again";return false}else{n.doRegister()}};n.doRegister=function(){n.formError="";e.register(n.credentials).error(function(t){n.formError=t}).then(function(){t.search("page",null);t.path(n.returnPage)})}}})();(function(){angular.module("tableMates").service("api",t);t.$inject=["$http"];function t(t){var e=function(){return t.get("http://newtablemates.azurewebsites.net/api/Appointment")};var n=function(e){return t.get("http://newtablemates.azurewebsites.net/api/Appointment/"+e)};var r=function(e){return t.post("http://newtablemates.azurewebsites.net/api/Appointment",e)};var o=function(e,n){return t.put("http://newtablemates.azurewebsites.net/api/Appointment/Attend?id="+n+"&attendeeName="+e)};return{allAppointments:e,appointmentById:n,createAppointment:r,attendAppointment:o}}})();(function(){angular.module("tableMates").service("authentication",t);t.$inject=["$http","$window"];function t(t,e){var n=function(t){e.localStorage["tm-token"]=t};var r=function(){return e.localStorage["tm-token"]};var o=function(){var t=r();if(t){var n=JSON.parse(e.atob(t.split(".")[1]));return n.exp>Date.now()/1e3}else{return false}};var a=function(){if(o()){var t=r();var n=JSON.parse(e.atob(t.split(".")[1]));return{email:n.email,name:n.name}}};register=function(e){var r={username:e.name,email:e.email};console.log(r);t.post("http://newtablemates.azurewebsites.net/api/Attendee",r).success(function(t){console.log("Posted to azure!")});return t.post("/api/register",e).success(function(t){n(t.token)})};login=function(e){return t.post("/api/login",e).success(function(t){n(t.token)})};logout=function(){e.localStorage.removeItem("tm-token")};return{currentUser:a,saveToken:n,getToken:r,isLoggedIn:o,register:register,login:login,logout:logout}}})();